{% extends "template/base.html" %} 

{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static 'plugins/jsgrid/jsgrid.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/jsgrid/jsgrid-theme.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/bootstrap-toggle/css/bootstrap-toggle.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}"></script>
  <link rel="stylesheet" href="{% static 'plugins/datatables/jquery.dataTables.min.css' %}"></script>
  <style>

    /* display alignment with padding */
    .content {
      padding: 15px 7px !important;
    }

    /* side menu button */
    .btn-app-side {
      margin: 0 0 10px 0px !important;
      min-width: 110px;
  }
    </style>
{% endblock %}

{% block javascript %}

<script type="text/javascript" src="{% static 'plugins/jsgrid/jsgrid.min.js' %}"></script>
<script type="text/javascript" src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
<script type="text/javascript" src="{% static 'plugins/bootstrap-toggle/js/bootstrap-toggle.min.js' %}"></script>
<script type="text/javascript" src="{% static 'plugins/moment/moment.min.js' %}"></script>
<script type="text/javascript" src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
<script type="text/javascript" src="{% static 'plugins/echarts/echarts.min.js' %}"></script>
<script type="text/javascript" src="{% static 'plugins/datatables/datatables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/shortcut.js' %}"></script>



<script type="text/javascript">

/* page load */
window.addEventListener('DOMContentLoaded', function(){
  
});

let mqtt_client_id = "mex-client-"+parseInt(Math.random()*10000, 10);
var mqtt_client = new Paho.Client("{{system.mqtt_broker_ip}}", Number({{system.mqtt_broker_port}}), mqtt_client_id);
var mqtt_connected = false;
mqtt_client.onConnectionLost = mqtt_onConnectionLost;
mqtt_client.onMessageArrived = mqtt_onMessageArrived;
mqtt_client.connect({onSuccess:mqtt_onConnect, onFailure:mqtt_onFailure, reconnect: true, useSSL:false});

/* MQTT Connection event callback */
function mqtt_onConnect(){
  mqtt_connected = true;
  mqtt_client.subscribe("mex/#");
  $.notify("Successfully connected to system!!", {className: "success",position:"bottom left"});
}

/* MQTT Failure event callback */
function mqtt_onFailure(){
  $.notify("System connection has a problem", {className: "error",position:"bottom left"});
}

/* MQTT Connection lost event callback */
function mqtt_onConnectionLost(responseObject){
    mqtt_connected = false;
    $.notify("System connection is lost", {className: "error",position:"bottom left"});
}

/* MQTT message arrived event callback */
function mqtt_onMessageArrived(message){
    const payload = JSON.parse(message.payloadString);

    switch(message.topic){
      case "mex/sensor/temperature": { //temperature data

      } break;

      case "mex/sensor/rpm":{ //rpm data

      } break;

      case "mex/sensor/load":{ //loadcell
        //payload["load"]
      } break;
      
    }

}


//   /* MQTT commands */
//   window.addEventListener("command", function(event){
//         switch(event.data.function){
//             case "program_start": { 
//                 // on_device_manual_control(url, event.data.args);
//             } break; 
//             case "program_pause" : {
//             } break;
//             case "program_stop" : { 
//             } break; 
//             case "set_zero" : { 
//             } break; 
//             case "rotate_forward" : { 
//             } break;
//             case "rotate_reverse" : { 
//             } break;
//             case "rotate_stop" : { 
//             } break;
//             case "motor_on":{
//             } break;
//             case "motor_off":{
//             } break;
//             case "side_load_on":{
//             } break;
//             case "side_load_off":{
//             } break;
//         }
//     });




</script>

{% endblock %}

{% block contents %}
  <!-- for hidden configurations -->
  {% include 'modal_hconf.html' %}
  <!-- for chart data open -->
  {% include 'modal_chart_open.html' %}
  <!-- for new settings -->
  {% include 'modal_settings_new.html' %}
  <!-- for notification -->
  {% include 'modal_notify.html' %}
  <!-- for error -->
  {% include 'modal_error.html' %}

<!-- main contents -->
<div class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-6 pr-0">
        {% include 'card_settings.html' %}
      </div>
      <div class="col-lg-1 pl-0">
        {% include 'card_settings_menu.html' %}
      </div>
      <div class="col-lg-4 pr-0">
        {% include 'card_status.html' %}
      </div>
      <div class="col-lg-1 pl-0">
        {% include 'card_status_menu.html' %}
      </div>
    </div>
    <div class="row">
      <div class="col-lg-11 pr-0">
        {% include 'card_chart.html' %}
      </div>
      <div class="col-lg-1 pl-0">
        {% include 'card_chart_menu.html' %}
      </div>
    </div>
  </div>
</div>

{% endblock %}


{% block post_javascript %}
<script type="text/javascript">

</script>
{% endblock %}