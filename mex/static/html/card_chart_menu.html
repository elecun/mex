
<style>
    .fab {
       width: 70px;
       height: 70px;
       border-radius: 50%;
       transition: all 0.1s ease-in-out;
     
       font-size: 50px;
       color: white;
       text-align: center;
       line-height: 70px;
     
       position: fixed;
       right: 120px;
       bottom: 120px;
    }
     
    .fab:hover {
       transform: scale(1.05);
    }
    
    .fab:active {
       transform: translateY(4px);
    }
</style>

{% load static %}

<a class="btn btn-app invisible mb-0" id="btn_empty">
</a>

<a class="btn btn-app btn-app-side bg-success shadow" id="btn_chart_open">
    <i class="fas fa-folder-open"></i> {{menu_ko.chart_open}}
</a>

<a class="btn btn-app btn-app-side bg-dark shadow" id="btn_chart_raw_download">
   <i class="fas fa-file-csv"></i> {{menu_ko.chart_raw_download}}
</a>

<a class="btn btn-app btn-app-side bg-dark shadow" id="btn_chart_image_download">
   <i class="fas fa-image"></i> {{menu_ko.chart_image_download}}
</a>

<div class="fab"><img src="{% static 'images/emg.png' %}" id="btn_emergency_stop"></div>


<script language="javascript">

/* page load */
window.addEventListener('DOMContentLoaded', function(){
   
});


/* emergency stop request */
async function request_emergency_stop(){
      let param = {"command":"control_emergency"};
      let response = await REST_POST("{% url 'control_emergency' %}", param);
      console.log(response);
}

/* csv download */
async function request_csv_download(){
   //console.log(response);
}

/* emergency stop event */
document.getElementById("btn_emergency_stop").addEventListener("click", function() {
   request_emergency_stop();
});



/* load data */
document.getElementById("btn_chart_open").addEventListener("click", function() {
   $('#modal_chart_open').modal('show');
});

/* emergency stop event */
document.getElementById("btn_chart_image_download").addEventListener("click", function() {
   var img = new Image();
   img.src = myChart.getDataURL({
      pixelRatio: 2,
      backgroundColor: '#fff'
   });
   
   var a = document.createElement('a');
   a.style = 'display: none';
   a.href = img.src;
   a.download = 'new_file_name.png';
   document.body.appendChild(a);
   a.click();
   setTimeout(function () {
  // 다운로드가 안되는 경우 방지
  document.body.removeChild(a);
}, 100);
});

   /* data csv download */
   document.getElementById("btn_chart_raw_download").addEventListener("click", function(){
      var _headers = ['h1', 'h2', 'h3'];
      var time = ['1','2','3','4','5','6','7','8','9'];
      var data1 = ['a','a','a','a','a','a','a','a','a'];
      var data2 = ['b','b','b','b','b','b','b','b','b'];

      // prepare CSV data
      var csvData = new Array();
      csvData.push(_headers);

    for (i = 0; i < time.length; i++) {
        csvData.push(new Array(time[i], data1[i], data2[i]));
    }

    var lineArray = [];
    csvData.forEach(function (infoArray, index) {
        var line = infoArray.join(",");
        lineArray.push(index == 0 ? "\uFEFF" + line : line); 
    });
    var csvContent = lineArray.join("\n");

    // download stuff
    var blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
    var link = document.createElement("a");

    if (link.download !== undefined) { // feature detection
        // Browsers that support HTML5 download attribute
        link.setAttribute("href", window.URL.createObjectURL(blob));
        link.setAttribute("download", "data.csv");
        link.setAttribute("hidden", true);
    }
    else {
        // it needs to implement server side export
        console.log('error');
        link.setAttribute("href", "#");
    }
    //link.innerHTML = "Export to CSV";
    //document.body.appendChild(link);
    link.click();
   });


</script>