<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ system.title }}</title>

  {%load static %}

  <link rel="stylesheet" href="{% static 'dist/css/font.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/ionicons/css/ionicons.min.css' %}">
  <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
  {% block css %}
  {% endblock %}

  <script type="text/javascript" src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'dist/js/adminlte.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/chart.js/chart.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'plugins/paho-mqtt/paho-mqtt.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/restapi.js' %}"></script>
  
<script type="text/javascript">
  let mqtt_client_id = "mex-client-"+parseInt(Math.random()*10000, 10);
  var mqtt_client = new Paho.Client("{{system.mqtt_broker_ip}}", Number({{system.mqtt_broker_port}}), mqtt_client_id);
  var mqtt_connected = false;
  mqtt_client.onConnectionLost = mqtt_onConnectionLost;
  mqtt_client.onMessageArrived = mqtt_onMessageArrived;
  mqtt_client.connect({onSuccess:mqtt_onConnect, onFailure:mqtt_onFailure, reconnect: true, useSSL:false});
  function mqtt_onConnect(){
      mqtt_client.subscribe("mex/command/#", {qos:2});
  }

  function mqtt_onFailure(){
      console.log("MQTT Failed");
  }

  function mqtt_onConnectionLost(responseObject){
      mqtt_connected = false;
  }

  function mqtt_onMessageArrived(message){
      const payload = JSON.parse(message.payloadString);

      switch(message.topic){
        case "mex/command/emergency": break;
      }

  }
</script>
  {% block javascript %}
  {% endblock %}

</head>

{% csrf_token %}

<body>

{% csrf_token %}
{% block contents %}
{% endblock %}

</body>

</html>
